---
const API_KEY = import.meta.env.NASA_API_KEY;
const NASA_URL = `https://api.nasa.gov/planetary/apod?api_key=${API_KEY}`;
const MARS_URL = `https://api.nasa.gov/insight_weather/?api_key=${API_KEY}&feedtype=json&ver=1.0`;

const response = await fetch(NASA_URL);
const data = await response.json();

const MarsResponse = await fetch(MARS_URL);
const MarsData = await MarsResponse.json();

const lastSol = MarsData.sol_keys[0];
const solData = MarsData[lastSol];
---

<html lang="en">
  <a href="/">Return</a>

  <body>
    <h1>Foto del dia</h1>
    <h2>{data.title}</h2>
    <p>{data.date}</p>

    {
      data.media_type === "image" ? (
        <img src={data.url} alt={data.title} width="700" />
      ) : (
        <iframe width="800" height="400" src={data.url} />
      )
    }
  </body>

  <p>{data.explanation}</p>

  <h1>Mars Weather</h1>

  {
    !solData ? (
      <p>No Mars weather data available (InSight API ended in 2022).</p>
    ) : (
      <>
        <p>Last Sol: {lastSol}</p>
        <p>Earth Date: {new Date(solData.First_UTC).toDateString()}</p>
        <p>Average Temp: {solData.AT?.av ?? "N/A"} Â°C</p>
      </>
    )
  }


</html>
